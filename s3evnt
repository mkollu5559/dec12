variable "enable_s3_cloudwatch_event" {
  type    = bool
  default = false
}

variable "event_pattern_file" {
  type    = string
  default = null

  validation {
    condition = (
      var.enable_s3_cloudwatch_event == false ||
      (var.event_pattern_file != null && trim(var.event_pattern_file) != "")
    )
    error_message = "event_pattern_file must be provided when enable_s3_cloudwatch_event is true."
  }
}

resource "aws_cloudwatch_event_rule" "event_rule" {
  count = var.enable_s3_cloudwatch_event ? 1 : 0

  name           = "${var.function_name}-event-rule"
  event_bus_name = "sftp-nit-nis-ext-cloudwatch_event_bus"
  tags           = local.tags_local

  event_pattern = file(var.event_pattern_file)
}
